<!DOCTYPE html>
<html>
<head>
    <title>Rotten Soup</title>
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <script src="https://use.fontawesome.com/d7889c2247.js"></script>
    <!-- Vue -->
    <script src="assets/js/vue.js"></script>
    <!-- Vuetify -->
    <link href="assets/css/vuetify.min.css" rel="stylesheet" type="text/css">
    <script src="assets/js/vuetify.min.js"></script>
    <!-- Local app files -->
    <script src="assets/js/rot.js"></script>
    <script src="assets/js/jquery.min.js"></script>
    <!-- Entities -->
    <script src="assets/js/game/entities/Entity.js"></script>
    <script src="assets/js/game/entities/Ladder.js"></script>
    <!-- Actors -->
    <script src="assets/js/game/entities/actors/Goblin.js"></script>
    <script src="assets/js/game/entities/actors/Player.js"></script>
    <script src="assets/js/game/entities/actors/Rat.js"></script>
    <!-- Weapons-->
    <script src="assets/js/game/entities/items/weapons/Weapon.js"></script>
    <script src="assets/js/game/entities/items/weapons/Sword.js"></script>
    <!-- Game, Utilities, and Map -->
    <script src="assets/maps/expanded_start.js"></script>
    <script src="assets/js/game/utils.js"></script>
    <script src="assets/js/game/Game.js"></script>
</head>
<body>
<div id="app">
    <v-layout row>
        <v-flex xs11 col><h1>Rotten Soup</h1></v-flex>
        <v-flex xs1 col>
            <v-layout style="margin: 2em auto;">
                <a style="text-decoration: none;" href="https://github.com/Larkenx/Rotten-Soup">
                    <v-btn icon ripple >
                        <i style="color: lightgray; margin: auto;" class="fa fa-3x fa-github" aria-hidden="true"></i>
                    </v-btn>
                </a>
            </v-layout>
        </v-flex>
    </v-layout>
    <v-container class="bordered" style="padding: 0px; width:1150px; margin: auto;">
        <!-- Game Display and HUD -->
        <v-layout id="row1" row wrap style="padding: 0; margin:0;">
            <!-- Game Display-->
            <v-flex column style="padding: 0px;">
                <div style="margin:0; padding:0;" class="" id="game_container"></div>
            </v-flex>
            <!-- HUD-->
            <v-flex class="hud elevation-0" column style="width: 440px; margin: 0 auto; padding-top: 5px;">
                <!-- Health Bar -->
                <v-layout row align-center style=" margin-bottom: -10px;">
                    <v-flex xs2 col>
                        <b>Health </b>
                    </v-flex>
                    <v-flex xs7 col>
                        <v-progress-linear :value="(getHP() / getMaxHP()) * 100" height="10" error></v-progress-linear>
                    </v-flex>
                    <v-flex xs3 col>
                        {{getHP()}} / {{getMaxHP()}}
                    </v-flex>
                </v-layout>
                <!-- Magic Bar -->
                <v-layout row align-center>
                    <v-flex xs2 col>
                        <b>Mana</b>
                    </v-flex>
                    <v-flex xs7 col>
                        <v-progress-linear :value="(getMana() / getMaxMana()) * 100" height="10"
                                           info></v-progress-linear>
                    </v-flex>
                    <v-flex xs3 col>
                        {{getMana()}} / {{getMaxMana()}}
                    </v-flex>
                </v-layout>
                <!-- Skills -->
                <v-layout row style="margin-top: 10px;">
                    <v-flex xs12 col><b>Stats</b></v-flex>
                </v-layout>
                <v-layout row style="margin-left: 10px;">
                    <v-flex xs12 col><b>DEF {{getCB().def}}</b></v-flex>
                </v-layout>
                <v-layout row style="margin-left: 10px;">
                    <v-flex col><b>STR {{getCB().str}}</b></v-flex>
                </v-layout>
                <!-- Mini-map -->
                <v-layout row>
                    <v-layout xs12 column align-center style="margin: 10px auto;"><b>Minimap</b></v-layout>
                </v-layout>
                <v-layout row align-center>
                    <div id="minimap_container" class="flex" style="margin: 0 auto;"></div>
                </v-layout>
                <!-- Inventory -->
                <v-layout row style="margin-top: 10px;">
                    <v-flex xs12 col><b>Inventory</b></v-flex>
                </v-layout>
                <v-layout v-for="(row, index) in rows" class="inventory_row" row v-bind:key="index">
                    <v-flex class="inventory_slot" xs1 col v-for="(slot, i) in getInventoryRow(index)" v-bind:key="i">
                        <v-layout>
                            <span style="margin: auto;" v-if="slot.item !== null">{{slot.item.options.symbol}}</span>
                        </v-layout>

                    </v-flex>
                </v-layout>
            </v-flex>
        </v-layout>
        <!-- Game Console / Messages -->
        <v-layout id="row2" row style="padding: 10px 0 0 0; margin: 0px">
            <v-list id="fix_scroll" class="hud console" style="overflow:hidden; padding: 8px; position: relative;">
                <v-list-item v-for="(message, index) in getMessages()" v-bind:key="index">
                    <p><b v-bind:style="{color : message[1]}">{{message[0]}}</b></p>
                </v-list-item>
            </v-list>
        </v-layout>
        <!-- Death Modal -->
        <v-container class="bordered modal elevation-24" v-if="playerIsDead()" align-center>
               <pre>
                     _____  _____
                    <     `/     |
                     >          (
                    |   _     _  |
                    |  |_) | |_) |
                    |  | \ | |   |
                    |            |
     ______.______%_|            |__________  _____
   _/                                       \|     |
  |                    Here lies
  |_____.-._________      '@'   ____/|___________|
                    |            |
                    |            |
                    |            |
                    |            |
                    |   _        <
                    |__/         |
                     / `--.      |
                   %|            |%
               |/.%%|          -< @%%%
               `\%`@|     v      |@@%@%%
             .%%%@@@|%    |    % @@@%%@%%%%
        _.%%%%%%@@@@@@%%_/%\_%@@%%@@@@@@@%%%%%%
        </pre>
            <v-layout>
                <v-btn success class="btn--light-flat-pressed" v-on:click.native="startNewGame()"
                       style="margin: 0 auto;"><b>Play Again?</b></v-btn>
            </v-layout>
        </v-container>
    </v-container>

</div>
<script>
    let vm = new Vue({
        el: '#app',
        data () {
            return {
                messages: Game.message_history,
                rows : [1,2,3,4],
            };
        },
        computed () {
            return {
                inventory: Game.player.inventory
            }
        },
        methods: {
            getHP () {
                return Game.player.cb.hp;
            },
            getMaxHP() {
                return Game.player.cb.maxhp;
            },
            getMana() {
                return Game.player.cb.mana;
            },
            getMaxMana() {
                return Game.player.cb.maxmana;
            },
            getMessages() {
                return this.messages;
            },
            getCB() {
                return Game.player.cb;
            },
            playerIsDead() {
                if (Game.player === null)
                    return false;
                else
                    return Game.player.isDead();
            },
            getInventoryRow(n) {
                let inventory = Game.player.inventory;
                if (n === 0)
                    return inventory.slice(0, Math.floor(inventory.length / 2));
                else
                    return inventory.slice(Math.floor(inventory.length / 2), inventory.length);
            },
            startNewGame() {
                console.log("Starting new game...");
                $('#fix_scroll').empty();
                Game.init();
                $('#game_container').html(Game.display.getContainer());
                $('#minimap_container').html(Game.minimap.getContainer());
            }
        },
        created () {
            Game.init();
            Game.drawViewPort();
        },
        mounted () {
            $('#game_container').html(Game.display.getContainer());
            $('#minimap_container').html(Game.minimap.getContainer());
        },
    })
</script>
</body>
</html>
<style>
    @import url('https://fonts.googleapis.com/css?family=Press+Start+2P');
    body {
        background-color: black;
    }

    .console {
        width: 100%;
        height: 150px;
        line-height: 0;
    }

    .hud {
        background-color: black;
        color: white;
    }

    .bordered {
        padding: 0px;
        margin: 0px;
        border-style: solid;
        border-width: 5px;
        border-color: darkgrey;
    }

    .modal {
        background-color: black;
        color: white;
        /*width: 500px;*/
        padding: 10px;
        height: 600px;
        position: absolute;
        left: 40%;
        top: 5%;
        margin-left: -150px;
        z-index: 2;
        /*margin-top: -150px;*/
    }

    .inventory_row {
        margin-left: 10px;
    }

    .inventory_slot {
        margin: 2px;
        border: 2px solid #3d3d3d;
        border-radius: 4px;
        /*margin: 2px;*/
        min-width: 30px;
        min-height: 30px;
    }

    canvas {
        padding: 0;
        margin: 0;
    }
</style>
